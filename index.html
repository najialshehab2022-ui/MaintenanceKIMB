<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <title>ูููุฐุฌ ุชูุฑูุฑ ุตูุงูุฉ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />

  <!-- html2canvas for screenshot -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Flatpickr for date picker -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <style>
    body {
      direction: rtl;
      text-align: right;
      font-family: sans-serif;
    }

    /* ุชุฃูุฏ ูู ุฃู ุงููุต ุฏุงุฎู ุงูุญููู ูุธูุฑ ุนูู ุงููููู */
    input,
    textarea {
      text-align: right;
      resize: none;
      overflow: hidden;
    }

    .a4-container {
      width: 210mm;
      margin: auto;
      background: #fff;
      padding: 20px;
    }

    .signature-canvas {
      border: 1px solid #ccc;
      width: 100%;
      height: 150px;
    }

    #shareBtn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }

    @media print {
      #shareBtn {
        display: none;
      }

      .a4-container {
        box-shadow: none;
        margin: 0;
        padding: 0;
      }

      input,
      textarea {
        border: none !important;
        box-shadow: none !important;
      }
    }

    @media screen and (max-width: 210mm) {
      .a4-container {
        width: 100%;
        padding: 10px;
      }
    }
  </style>
</head>

<body>

  <div class="a4-container shadow-sm">
    <div class="container-fluid">

      <!-- Header -->
      <div class="row align-items-center text-center mb-4 g-2">
        <div class="col-md-3">
          <h6 class="fw-bold m-0">ุจูู ุงููุฑููู ููุชูููู ุงูุฃุตุบุฑ ุงูุฅุณูุงูู</h6>
        </div>
        <div class="col-md-6">
          <img src="kimb.png" alt="ุดุนุงุฑ" class="img-fluid" />
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">ุฑูู ุงูุชูุฑูุฑ:</label>
          <input type="text" class="form-control" placeholder="ุฃุฏุฎู ุฑูู ุงูุชูุฑูุฑ" />
        </div>
      </div>

      <!-- Title -->
      <div class="row mb-3">
        <div class="col text-center">
          <h4 class="fw-bold">ูููุฐุฌ ุชูุฑูุฑ ุตูุงูุฉ</h4>
        </div>
      </div>

      <!-- General Data -->
      <div class="row mb-4 g-2">
        <div class="col-md-3">
          <label class="form-label fw-semibold">ุชู ุงููุฒูู ุฅูู ููุทูุฉ:</label>
          <input type="text" class="form-control" placeholder="ุงูุฎูุณูู" onfocus="this.placeholder=''" />
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">ุงููุฑุน:</label>
          <input type="text" class="form-control" placeholder="ุญุฏุฉ" onfocus="this.placeholder=''" />
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">ุงูููู:</label>
          <input type="text" id="dayInput" class="form-control" readonly />
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">ุงูุชุงุฑูุฎ:</label>
          <input type="date" id="dateInput" class="form-control" onchange="updateDay()" />
        </div>
      </div>

      <!-- Maintenance Type -->
      <div class="row align-items-center mb-4">
        <div class="col-md-3 text-md-end text-center mb-2 mb-md-0">
          <label class="fw-semibold">ููุน ุงูุตูุงูุฉ:</label>
        </div>
        <div class="col-md-3 text-center">
          <input type="radio" name="maintenanceType" id="preventive" class="form-check-input me-2" />
          <label for="preventive" class="form-check-label">ุตูุงูุฉ ุงุณุชุจุงููุฉ</label>
        </div>
        <div class="col-md-3 text-center">
          <input type="radio" name="maintenanceType" id="emergency" class="form-check-input me-2" />
          <label for="emergency" class="form-check-label">ุตูุงูุฉ ุทุงุฑุฆุฉ</label>
        </div>
      </div>

      <!-- Maintenance Description Checkboxes -->
      <div class="row mb-4 text-center g-2">
        <div class="col-md-3">
          <label class="fw-semibold">ุชูุตูู ุงูุตูุงูุฉ:</label>
        </div>
        <div class="col-md-3">
          <input type="checkbox" id="assets" class="form-check-input me-2" />
          <label for="assets">ุฃุตูู ูุฎุฒูุงุช</label>
        </div>
        <div class="col-md-3">
          <input type="checkbox" id="option3" class="form-check-input me-2" />
          <label for="option3">ุฎูุงุฑ 3</label>
        </div>
        <div class="col-md-3">
          <input type="checkbox" id="option4" class="form-check-input me-2" />
          <label for="option4">ุฎูุงุฑ 4</label>
        </div>
      </div>

      <!-- Diagnosis & Actions -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <label class="fw-semibold">ุชู ุงูููุงู ุจุงููุญุต ูุงูุชุดุฎูุต ุนู ุงูุขุชู:</label>
          <textarea id="diagnosis" class="form-control mb-3" rows="1" oninput="autoExpand(this)" placeholder="..."></textarea>

          <label class="fw-semibold">ููุงูุช ูุชุงุฆุฌ ุงููุญุต ูุงูุฃุณุจุงุจ ูู:</label>
          <textarea id="results" class="form-control mb-3" rows="1" oninput="autoExpand(this)" placeholder="..."></textarea>

          <label class="fw-semibold">ูุชู ุชูููุฐ ุงููุนุงูุฌุงุช ุงูุขุชูุฉ:</label>
          <textarea id="actions" class="form-control" rows="1" oninput="autoExpand(this)" placeholder="..."></textarea>
        </div>

        <!-- Spare Parts Table -->
        <div class="col-md-6">
          <div class="table-responsive">
            <table class="table table-bordered text-center" id="partsTable">
              <thead class="table-light">
                <tr>
                  <th>ุงูุฃุตูุงู</th>
                  <th>ุงูุนุฏุฏ</th>
                  <th>ูุทุน ุงูุบูุงุฑ ุงููุณุชุจุฏูุฉ</th>
                  <th>ุฅุฌุฑุงุก</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><textarea class="form-control" rows="1" oninput="autoExpand(this)"></textarea></td>
                  <td><textarea class="form-control" rows="1" oninput="autoExpand(this)"></textarea></td>
                  <td><textarea class="form-control" rows="1" oninput="autoExpand(this)"></textarea></td>
                  <td><button class="btn btn-danger btn-sm" onclick="deleteRow(this)">๐ ุญุฐู</button></td>
                </tr>
              </tbody>
            </table>
          </div>
          <button class="btn btn-success" onclick="addRow()">โ ุฅุถุงูุฉ ุตู</button>
        </div>
      </div>

      <!-- Recommendations & Signatures -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="fw-bold">ูุฏูุฑ ุงููุฑุน - ุงุณุชููุช ุฃูุง:</label>
            <input type="text" class="form-control" placeholder="ุงุณู ุงููุฏูุฑ" />
          </div>
          <p>ุฌููุน ุฃุนูุงู ุงูุตูุงูุฉ ุงูุชู ููุฐูุง ุงููููุฏุณ ูุงูููุถุญุฉ ุฃุนูุงู ูุชู ุงุณุชูุงู ูุทุน ุงูุบูุงุฑ ุงูุชุงููุฉ ููู ููุง ููุฌุฏ ุฃู ูุตูุฑ ุจุงูุชูููุฐ.</p>
          <label class="fw-bold">ุชูุตูุงุช ูุฏูุฑ ุงููุฑุน:</label>
          <textarea class="form-control mb-2" rows="1" oninput="autoExpand(this)"></textarea>
          <label class="fw-bold">ุงูุชูููุน:</label>
          <!-- ุญุฏุฏ ุฃุจุนุงุฏ canvas -->
          <canvas id="managerSign" class="signature-canvas" width="600" height="150"></canvas>
          <button class="btn btn-secondary btn-sm mt-1" onclick="clearCanvas('managerSign')">ูุณุญ ุงูุชูููุน</button>
        </div>

        <div class="col-md-6">
          <div class="mb-3">
            <label class="fw-bold">ุงุณู ูููุฐ ุงูุตูุงูุฉ:</label>
            <input type="text" class="form-control" placeholder="ุงุณู ุงูููู ุฃู ุงููููุฏุณ" />
          </div>
          <label class="fw-bold">ุงูุชูููุน:</label>
          <canvas id="techSign" class="signature-canvas" width="600" height="150"></canvas>
          <button class="btn btn-secondary btn-sm mt-1" onclick="clearCanvas('techSign')">ูุณุญ ุงูุชูููุน</button>
        </div>
      </div>

    </div>
  </div>

  <button id="shareBtn">๐ค ุดุงุฑู ุงูุชูุฑูุฑ</button>

  <script>
    // ุถุจุท ุงูุชุงุฑูุฎ ูุงูููู ุชููุงุฆูุงู ุนูุฏ ุงูุชุญููู
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      document.getElementById('dateInput').value = `${yyyy}-${mm}-${dd}`;
      updateDay();

      // ุชููุฆุฉ flatpickr
      flatpickr("#dateInput", {
        dateFormat: "Y-m-d",
        defaultDate: today,
        onChange: updateDay
      });

      // ุชูุณูุน textarea ุชููุงุฆูุงู
      document.querySelectorAll('textarea').forEach(el => autoExpand(el));

      // ุชูุนูู ุงูุชูููุน
      initSignature('managerSign');
      initSignature('techSign');

      // ุฑุจุท ุฒุฑ ุงููุดุงุฑูุฉ
      document.getElementById('shareBtn').addEventListener('click', shareReport);
    });

    // ุชุญุฏูุซ ุงุณู ุงูููู
    function updateDay() {
      const val = document.getElementById('dateInput').value;
      if (!val) return;
      const days = ["ุงูุฃุญุฏ", "ุงูุฅุซููู", "ุงูุซูุงุซุงุก", "ุงูุฃุฑุจุนุงุก", "ุงูุฎููุณ", "ุงูุฌูุนุฉ", "ุงูุณุจุช"];
      document.getElementById('dayInput').value = days[new Date(val).getDay()];
    }

    // ุชูุจูุฑ textarea ุญุณุจ ุงููุญุชูู
    function autoExpand(el) {
      el.style.height = 'auto';
      el.style.height = el.scrollHeight + 'px';
    }

    // ุฅุถุงูุฉ ุตู ุฌุฏูุฏ
    function addRow() {
      const tbody = document.querySelector('#partsTable tbody');
      const tr = document.createElement('tr');
      for (let i = 0; i < 3; i++) {
        const td = document.createElement('td');
        const ta = document.createElement('textarea');
        ta.className = 'form-control';
        ta.rows = 1;
        ta.oninput = () => autoExpand(ta);
        td.appendChild(ta);
        tr.appendChild(td);
      }
      const td = document.createElement('td');
      const btn = document.createElement('button');
      btn.className = 'btn btn-danger btn-sm';
      btn.textContent = '๐ ุญุฐู';
      btn.onclick = () => deleteRow(btn);
      td.appendChild(btn);
      tr.appendChild(td);
      tbody.appendChild(tr);
    }

    // ุญุฐู ุตู
    function deleteRow(btn) {
      btn.closest('tr').remove();
    }

    // ูุณุญ ุงูุชูููุน
    function clearCanvas(id) {
      const c = document.getElementById(id);
      const ctx = c.getContext('2d');
      ctx.clearRect(0, 0, c.width, c.height);
    }

    // ุชูุนูู ุงูุชูููุน ุนูู canvas
    function initSignature(id) {
      const c = document.getElementById(id);
      const ctx = c.getContext('2d');
      let drawing = false;
      c.addEventListener('mousedown', () => drawing = true);
      c.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });
      c.addEventListener('mousemove', e => {
        if (!drawing) return;
        const rect = c.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      });
      // ุฏุนู ุงูููุณ
      c.addEventListener('touchstart', () => drawing = true);
      c.addEventListener('touchend', () => { drawing = false; ctx.beginPath(); });
      c.addEventListener('touchmove', e => {
        if (!drawing) return;
        const t = e.touches[0];
        const rect = c.getBoundingClientRect();
        const x = t.clientX - rect.left;
        const y = t.clientY - rect.top;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      });
    }

    // ูุดุงุฑูุฉ ุงูุชูุฑูุฑ ููุท
    function shareReport() {
      html2canvas(document.querySelector('.a4-container'), { useCORS: true }).then(canvas => {
        canvas.toBlob(async blob => {
          const file = new File([blob], 'maintenance-report.png', { type: 'image/png' });
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
              await navigator.share({
                files: [file],
                title: 'ุชูุฑูุฑ ุงูุตูุงูุฉ',
                text: 'ูุฐุง ูููุฐุฌ ุชูุฑูุฑ ุตูุงูุฉ.'
              });
            } catch (err) {
              alert('ูุดู ูู ุงููุดุงุฑูุฉ: ' + err);
            }
          } else {
            alert('ุงููุชุตูุญ ูุง ูุฏุนู ูุดุงุฑูุฉ ุงููููุงุช ูุจุงุดุฑุฉ.');
          }
        }, 'image/png');
      });
    }
  </script>

</body>
</html>